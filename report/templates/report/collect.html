<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Daily</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.js"></script>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<nav class="navbar navbar-default" role="navigation" style="background: #00B2EE">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" style="color: aliceblue;font-size: 23px;font-weight: bold">日报统计工具</a>
        </div>
        <div>
            <ul class="nav navbar-nav">
                <li><a href="edit" style="color: aliceblue;font-size: 18px">编辑日报</a></li>
                <li id="statistics" style="background: #009ACD"><a href="statistics"
                                                                   style="color: aliceblue;font-size: 18px">统计日报</a>
                </li>
                <li id="settings"><a href="settings"
                                     style="color: aliceblue;font-size: 18px">设置</a></li>
                <li id="search"><a href="search"
                                   style="color: aliceblue;font-size: 18px">搜索</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <p id="show_name" class="navbar-text" style="color: aliceblue;font-size: 15px"></p>
                <li><a href="#" onclick="logout()" style="color: aliceblue;font-size: 18px"><span
                        class="glyphicon glyphicon-log-out"></span> 登出</a></li>
            </ul>
        </div>
    </div>
</nav>

<h1>统计日报</h1>
<h3>以下人员未发日报：</h3>
<p id="unbilled_user"></p>
<style type="text/css">
    .AutoNewline {
        Word-break: break-all;
    }
</style>
<div id="collect_div" style="display: none">
    <h3>汇总日报：</h3>
    <table class="AutoNewline" id="collection" border="1" cellpadding="10" cellspacing="0">
        <tr>
            <th>项目</th>
            <th>工作类型</th>
            <th>Bug ID</th>
            <th>简要描述</th>
            <th>优先级</th>
            <th>是否reopen</th>
            <th>reopen原因</th>
            <th>解决方案</th>
            <th>原因</th>
            <th>责任人</th>
            <th>日期</th>
            <th>备注</th>
        </tr>
    </table>
    <br><br>
    <input id="download" onclick="download()" type="button" value="导出成Excel文件">
</div>

{#<script src="../../static/report/collect.js"></script>#}
<script>

    try {
        var user = document.cookie.match(/(^| )user=([^;]*)(;|$)/)[2].replace('"', '').replace('"', '');
        var team = document.cookie.match(/(^| )team=([^;]*)(;|$)/)[2];
        document.getElementById("show_name").innerText = user;
    } catch (e) {
        alert("请先登录!");
        window.location.href = 'login';
    }

    console.log(team);
    {#var team = document.cookie.split(";")[2].split("=")[1];#}
    $.get('collect', {"team": team}, function (ret) {
        if (ret != 0) {
            show_today(ret.info);
            document.getElementById("unbilled_user").innerText = ret.name.join(", ");
            document.getElementById('collect_div').style.display = '';
        } else {
            document.getElementById("unbilled_user").innerText = "目前全部未发日报！";
        }
    });

    function show_today(ret) {
        var today = document.getElementById("collection");
        for (var i = 0; i < ret.length; i++) {
            var line = document.createElement("tr");
            var cell_project = document.createElement("td");
            var cell_work_type = document.createElement("td");
            var cell_bugid = document.createElement("td");
            var cell_describe = document.createElement("td");
            var cell_priority = document.createElement("td");
            var cell_reopen = document.createElement("td");
            var cell_reopen_reason = document.createElement("td");
            var cell_solution = document.createElement("td");
            var cell_solution_reason = document.createElement("td");
            var cell_person = document.createElement("td");
            var cell_date = document.createElement("td");
            var cell_remake = document.createElement("td");
            cell_project.innerText = ret[i].project;
            cell_work_type.innerText = ret[i].work_type;
            cell_bugid.innerText = ret[i].bugid;
            cell_describe.innerText = ret[i].describe;
            cell_priority.innerText = ret[i].priority;
            cell_reopen.innerText = ret[i].reopen;
            cell_reopen_reason.innerText = ret[i].reopen_reason;
            cell_solution.innerText = ret[i].solution;
            cell_solution_reason.innerText = ret[i].solution_reason;
            cell_person.innerText = ret[i].person;
            cell_date.innerText = ret[i].date;
            cell_remake.innerText = ret[i].remake;
            line.appendChild(cell_project);
            line.appendChild(cell_work_type);
            line.appendChild(cell_bugid);
            line.appendChild(cell_describe);
            line.appendChild(cell_priority);
            line.appendChild(cell_reopen);
            line.appendChild(cell_reopen_reason);
            line.appendChild(cell_solution);
            line.appendChild(cell_solution_reason);
            line.appendChild(cell_person);
            line.appendChild(cell_date);
            line.appendChild(cell_remake);
            today.appendChild(line);
        }
    }

    function send() {

    }

    function download() {
        window.location.href = "download"
    }

    function logout() {
        document.cookie = "remember=false";
        $.get('logout');
        window.location.href = 'login';
    }

</script>
</body>
</html>