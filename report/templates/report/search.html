<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
</head>
<body>
<p>搜索已发日报</p>
worktype: <select id="work_type">
    <option>解决bug</option>
    <option>非bug库问题处理</option>
    <option>基线升级</option>
    <option>需求分析实现</option>
    <option>团队建设</option>
    <option>项目支持</option>
    <option>SPM工作</option>
    <option>请假</option>
</select><br>
bugid: <input id="search_bugid" type="text"><br>
describe: <input id="search_describe" type="text"><br>
solution: <select id="solution">
    <option></option>
    <option>入库</option>
    <option>转其他组</option>
    <option>非问题</option>
    <option>是问题不修改</option>
    <option>重复</option>
    <option>不复现关闭</option>
    <option>输出文档</option>
</select><br>
solution reason: <select id="solution_reason">
    <option></option>
    <option>原始问题</option>
    <option>转其他组</option>
    <option>修改引入</option>
    <option>新需求</option>
    <option>需求遗留问题</option>
    <option>非问题</option>
</select><br>
start date: <input id="start_date" type="date"><br>
end date: <input id="end_date" type="date"><br><br>
<input id="search" type="button" value="search" onclick="search()">

<p>搜索结果：</p>
<input onclick="download()" value="download excel" type="button"><br><br>
<table id="result" border="1" cellpadding="0" cellspacing="0">
    <tr>
        <th>项目</th>
        <th>工作类型</th>
        <th>Bug ID</th>
        <th>简要描述</th>
        <th>优先级</th>
        <th>是否reopen</th>
        <th>reopen原因</th>
        <th>解决方案</th>
        <th>原因</th>
        <th>责任人</th>
        <th>日期</th>
        <th>备注</th>
    </tr>
</table>
{#<script src="../../static/report/search.js"></script>#}
<script>
    var team = document.cookie.match(/(^| )team=([^;]*)(;|$)/)[2];

    function search() {

        if ("" === document.getElementById("work_type").value) {
            alert("工作类型不能为空！");
            return
        }

        if (("" === document.getElementById("start_date").value && "" !== document.getElementById("end_date").value) ||
            ("" === document.getElementById("end_date").value && "" !== document.getElementById("start_date").value)) {
            alert("起始、终止日期要填全！");
            return
        }

        var info = {
            team: team,
            worktype: document.getElementById("work_type").value,
            bugid: document.getElementById("search_bugid").value,
            describe: document.getElementById("search_describe").value,
            solution: document.getElementById("solution_reason").value,
            start_date: document.getElementById("start_date").value,
            end_date: document.getElementById("end_date").value
        };
        $.get('search_info', {"info": JSON.stringify(info)}, function (ret) {
            if (ret != 0){
                show_result(ret);
            }
        })
    }

    function show_result(ret) {
        var result = document.getElementById("result");
        $("#result").find("tr:not(:first)").empty("");
        console.log(result.children);
        for (var i = 0; i < ret.length; i++) {
            var line = document.createElement("tr");
            var cell_project = document.createElement("td");
            var cell_work_type = document.createElement("td");
            var cell_bugid = document.createElement("td");
            var cell_describe = document.createElement("td");
            var cell_priority = document.createElement("td");
            var cell_reopen = document.createElement("td");
            var cell_reopen_reason = document.createElement("td");
            var cell_solution = document.createElement("td");
            var cell_solution_reason = document.createElement("td");
            var cell_person = document.createElement("td");
            var cell_date = document.createElement("td");
            var cell_remake = document.createElement("td");
            cell_project.innerText = ret[i].project;
            cell_work_type.innerText = ret[i].work_type;
            cell_bugid.innerText = ret[i].bugid;
            cell_describe.innerText = ret[i].describe;
            cell_priority.innerText = ret[i].priority;
            cell_reopen.innerText = ret[i].reopen;
            cell_reopen_reason.innerText = ret[i].reopen_reason;
            cell_solution.innerText = ret[i].solution;
            cell_solution_reason.innerText = ret[i].solution_reason;
            cell_person.innerText = ret[i].person;
            cell_date.innerText = ret[i].date;
            cell_remake.innerText = ret[i].remake;
            line.appendChild(cell_project);
            line.appendChild(cell_work_type);
            line.appendChild(cell_bugid);
            line.appendChild(cell_describe);
            line.appendChild(cell_priority);
            line.appendChild(cell_reopen);
            line.appendChild(cell_reopen_reason);
            line.appendChild(cell_solution);
            line.appendChild(cell_solution_reason);
            line.appendChild(cell_person);
            line.appendChild(cell_date);
            line.appendChild(cell_remake);
            result.appendChild(line);
        }
    }

    function download() {
        window.location.href = "download_search"
    }
</script>
</body>
</html>